---
title: Linux中ln命令的用法以及分析
id: 1
categories:
  - Linux
date: 2015-11-03 23:44:41
tags:
  - Linux
---

在ubuntu用也有类似于windows中快捷方式这种类型的东西，即链接。这里一般使用ln命令来执行得到，ln命令用法简单，但是与windows不同，这里有硬链接和软链接两种类型的链接。在介绍两种链接的时候，我们先来了解一下Linux的文件系统。

## 文件系统
在Linux中每一个文件大体上由三个部分组成：
1. 文件名：这个是用来标记这个文件的符号，也就是我们所理解的文件名；
2. inode：inode存放的是文件的metadata，也就是元信息，包括了文件的权限、创建时间、修改时间、唯一id、文件种类、一个与文件名数目对应的链接数，最后还有一个指向实际数据区域的指针。我们可以用stat命令来查看文件的inode信息。
3. 数据区：这里是真正保存数据的地方。

当我们创建一个文件的时候，我们实际上是创建了这个文件的文件名以及inode，只有当我们真正写数据的时候，我们才会想数据区里写入数据。
当我们删除一个文件的时候，我们实际上是删除了这个文件的文件名，然后这个文件对应的inode的连接数会减一，当这个连接数减为0的时候，操作系统才会讲这个inode删除，也就是删除了这个文件。

## 硬链接

![](/images/2015/11/03/1/1.png)

硬链接相当于给文件重新起了一个名字，没有创建inode，只是对inode的链接数加了1，更没有数据的拷贝，新创建的名字与原来的名字从本质上没有任何先后次序，是对等存在的。对一个文件的修改就是对另一个文件的修改。当删除一个文件的时候，只是删除了这个文件名，并且将对应inode的链接数减了1。

硬链接还有一些非常有趣的性质：

### 不允许给目录创建硬链接
为什么不允许给目录创建硬链接呢？原因其实非常好玩。事实上Linux对目录本身是有硬链接的，我们知道每一个文件夹下都至少会有两个链接，一个是'.'、表示当前文件本身；另一个是'..'、表示当前文件的父目录。事实上，这个'.'就是对当前文件的一个硬链接，而'..'是对当前文件夹的父目录的硬链接，这就是为什么如果我们新建一个文件夹后，用stat查看这个文件夹的链接数，会发现这个数至少是2而不是1。
既然有硬链接，那么为什么不允许用户创建呢？原因也很有趣。如果任由用户随意添加硬链接，那么很容易出现一种情况，就是比如dir1->dir3 , dir2->dir3，这时如果我们在dir3下执行cd .. ，那么我们应该跳到哪里呢？显然这是一个不可描述的问题。因此，为了避免这种情况的发生，Linux的设计者才做了这样一个规定。

### 只有在同一文件系统中的文件之间才能创建链接。
这一点跟软链接不同，由于硬链接中的两个文件名需要映射到同一个inode上，而这个文件系统的inode显然不能被另一个文件系统直接看到，因此也就不能跨文件系统访问了。

事实上，硬链接用的不多，比较常用的是软链接：

## 软链接
![](/images/2015/11/03/1/2.png)

软链接又叫符号链接，就是传统意义上windows中的那种链接，本身可以看做是一种指针，指向实际的文件。

具体ln命令的用法：

ln 源文件 目标文件        //默认创建硬链接

ln -s 源文件 目标文件    //加-s （symbolic）选项创建软链接

创建的软链接在用ls -l 查看的时候是会显示细节的，比如：
```bash
myths@myths-X450LD:~/test$ ln -s a.txt b.txt
myths@myths-X450LD:~/test$ ls
a.txt  b.txt
myths@myths-X450LD:~/test$ ls -l
总用量 4
-rw-rw-r-- 1 myths myths 6 11月  6 00:27 a.txt
lrwxrwxrwx 1 myths myths 5 11月  6 00:29 b.txt -> a.txt
myths@myths-X450LD:~/test$
```
这里权限的第一个位置写的是  l  表明这是一个软链接，而且最后还会有一个箭头指向实际的文件。

当然也可以用readlink 命令来显示链接目的地：
```
myths@myths-X450LD:~/test$ readlink  b.txt
a.txt
```
实际中用到软链接的地方是很多的，比如显示网站的时候，一般将index.html指向实际想执行的文件来默认显示网站打开的网页。

## 参考文献
[NMSU CS课件](https://www.cs.nmsu.edu/~pfeiffer/classes/474/notes/inodefs.html)
